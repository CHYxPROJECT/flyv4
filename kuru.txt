--[[
    EXECUTED BY OXV-GPT
    PROJECT: MEMEKFLY QUANTUM V4 (ULTRA SMOOTH & SELECTIVE)
    DEV: nana
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LPlr = Players.LocalPlayer
local Mouse = LPlr:GetMouse()
local Camera = workspace.CurrentCamera

-- // CONFIG DYNAMIC
local AimSmoothness = 0.08 -- Default awal (Sangat Smooth)
local AimPart = "Head"
local fovSize = 150

-- // UI RE-INJECTION BYPASS
if game.CoreGui:FindFirstChild("MEMEKFLY_V4") then
    game.CoreGui.MEMEKFLY_V4:Destroy()
end

local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "MEMEKFLY_V4"

local Main = Instance.new("Frame", ScreenGui)
Main.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
Main.Position = UDim2.new(0.5, -130, 0.35, 0)
Main.Size = UDim2.new(0, 260, 0, 450)
Main.Active = true
Main.Draggable = true
local mainStroke = Instance.new("UIStroke", Main)
mainStroke.Color = Color3.fromRGB(0, 255, 200)
mainStroke.Thickness = 2
Instance.new("UICorner", Main)

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundColor3 = Color3.fromRGB(0, 150, 150)
Title.Text = "QUANTUM V4 - ULTRA SMOOTH"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Instance.new("UICorner", Title)

-- // UI HELPER
local function CreateBtn(txt, pos, color, callback)
    local btn = Instance.new("TextButton", Main)
    btn.Text = txt
    btn.Position = pos
    btn.Size = UDim2.new(0, 115, 0, 35)
    btn.BackgroundColor3 = color or Color3.fromRGB(20, 20, 30)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- // --- FEATURES ---

-- 1. AIMBOT & LOCK SYSTEM
local aimOn = false
local lockTarget = nil

local aimBtn = CreateBtn("AIMBOT: OFF", UDim2.new(0, 10, 0, 50), Color3.fromRGB(150, 0, 0))
aimBtn.MouseButton1Click:Connect(function()
    aimOn = not aimOn
    aimBtn.Text = "AIMBOT: " .. (aimOn and "ON" or "OFF")
    aimBtn.BackgroundColor3 = aimOn and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
    if not aimOn then lockTarget = nil end
end)

local partBtn = CreateBtn("PART: HEAD", UDim2.new(0, 135, 0, 50), Color3.fromRGB(0, 100, 200))
partBtn.MouseButton1Click:Connect(function()
    AimPart = (AimPart == "Head" and "HumanoidRootPart" or "Head")
    partBtn.Text = "PART: " .. (AimPart == "Head" and "HEAD" or "BODY")
end)

-- 2. SMOOTHNESS CONTROL (Super Important!)
local smoothDisp = Instance.new("TextLabel", Main)
smoothDisp.Text = "SMOOTHNESS: " .. AimSmoothness
smoothDisp.Position = UDim2.new(0, 10, 0, 95)
smoothDisp.Size = UDim2.new(0, 240, 0, 20)
smoothDisp.BackgroundTransparency = 1
smoothDisp.TextColor3 = Color3.fromRGB(0, 255, 255)

CreateBtn("SLOWER (SMOOTH)", UDim2.new(0, 10, 0, 120), Color3.fromRGB(40, 40, 40), function()
    if AimSmoothness > 0.01 then
        AimSmoothness = math.floor((AimSmoothness - 0.01) * 100) / 100
        smoothDisp.Text = "SMOOTHNESS: " .. AimSmoothness
    end
end)

CreateBtn("FASTER (SNAP)", UDim2.new(0, 135, 0, 120), Color3.fromRGB(40, 40, 40), function()
    if AimSmoothness < 0.5 then
        AimSmoothness = math.floor((AimSmoothness + 0.01) * 100) / 100
        smoothDisp.Text = "SMOOTHNESS: " .. AimSmoothness
    end
end)

-- 3. FOV SETTINGS
local fovDisp = Instance.new("TextLabel", Main)
fovDisp.Text = "CIRCLE FOV: " .. fovSize
fovDisp.Position = UDim2.new(0, 10, 0, 165)
fovDisp.Size = UDim2.new(0, 240, 0, 20)
fovDisp.BackgroundTransparency = 1
fovDisp.TextColor3 = Color3.fromRGB(255, 255, 0)

CreateBtn("FOV +", UDim2.new(0, 10, 0, 190), Color3.fromRGB(30, 30, 30), function()
    fovSize = fovSize + 10
    fovDisp.Text = "CIRCLE FOV: " .. fovSize
end)
CreateBtn("FOV -", UDim2.new(0, 135, 0, 190), Color3.fromRGB(30, 30, 30), function()
    if fovSize > 20 then fovSize = fovSize - 10 end
    fovDisp.Text = "CIRCLE FOV: " .. fovSize
end)

-- 4. MANUAL TARGET SELECTOR
local selectBtn = CreateBtn("CLICK TO LOCK: OFF", UDim2.new(0, 10, 0, 235), Color3.fromRGB(100, 0, 150))
local manualMode = false
selectBtn.MouseButton1Click:Connect(function()
    manualMode = not manualMode
    selectBtn.Text = "CLICK TO LOCK: " .. (manualMode and "ON" or "OFF")
    if not manualMode then lockTarget = nil end
end)

-- // CORE LOGIC
local fovCircle = Instance.new("Frame", ScreenGui)
fovCircle.Size = UDim2.new(0, fovSize*2, 0, fovSize*2)
fovCircle.BackgroundTransparency = 1
fovCircle.Visible = false
local stroke = Instance.new("UIStroke", fovCircle)
stroke.Color = Color3.fromRGB(0, 255, 200)
stroke.Thickness = 1
Instance.new("UICorner", fovCircle).CornerRadius = UDim.new(1, 0)

RunService.RenderStepped:Connect(function()
    fovCircle.Visible = aimOn
    fovCircle.Size = UDim2.new(0, fovSize*2, 0, fovSize*2)
    fovCircle.Position = UDim2.new(0.5, -fovSize, 0.5, -fovSize)

    if aimOn then
        if manualMode then
            -- MANUAL TARGETING (Hanya lock yang diklik/dipilih)
            if Mouse.Target and Mouse.Target.Parent:FindFirstChild("Humanoid") then
                if game:GetService("UserInputService"):IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
                    lockTarget = Mouse.Target.Parent:FindFirstChild(AimPart)
                end
            end
        else
            -- AUTO TARGETING (Berdasarkan jarak terdekat di FOV)
            local closest = nil
            local dist = fovSize
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LPlr and p.Character and p.Character:FindFirstChild(AimPart) and p.Character.Humanoid.Health > 0 then
                    local pos, os = Camera:WorldToViewportPoint(p.Character[AimPart].Position)
                    if os then
                        local mDist = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(pos.X, pos.Y)).Magnitude
                        if mDist < dist then
                            dist = mDist
                            closest = p.Character[AimPart]
                        end
                    end
                end
            end
            lockTarget = closest
        end

        if lockTarget and lockTarget.Parent and lockTarget.Parent.Humanoid.Health > 0 then
            local targetPos = CFrame.new(Camera.CFrame.Position, lockTarget.Position)
            Camera.CFrame = Camera.CFrame:Lerp(targetPos, AimSmoothness)
        else
            lockTarget = nil
        end
    end
end)

-- MISC
CreateBtn("NOCLIP", UDim2.new(0, 10, 0, 280), nil, function()
    _G.noclip = not _G.noclip
    RunService.Stepped:Connect(function()
        if _G.noclip and LPlr.Character then
            for _, v in pairs(LPlr.Character:GetDescendants()) do if v:IsA("BasePart") then v.CanCollide = false end end
        end
    end)
end)

CreateBtn("CLOSE UI", UDim2.new(0, 135, 0, 280), Color3.fromRGB(100, 0, 0), function() ScreenGui:Destroy() end)
